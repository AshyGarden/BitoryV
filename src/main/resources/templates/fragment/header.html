<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="header">
    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <a href="/index" class="logo">
                            <h1><img src="/assets/images/Logo3.png" style="width:15%"> Bitory</h1>
                        </a>
                        <!-- ***** Logo End ***** -->

                        <!-- ***** UserInfo Start ***** -->
                        <!-- 사용자 ID 표시 -->
                        <div style="float:right; color:white; margin:0px 30px; font-size:30px;" class="right_username user-id" th:text="${session.oti}+'님'">User Id</div>

                        <!-- 사용자 예산 표시 -->
                        <div style="float:right; color:white; margin:0px 30px; font-size:20px;" class="right_username user-budget" id="user-budget">User Budget</div>
                        <!-- ***** UserInfo End ***** -->

                        <!-- User의 매수/매도총합 -->
                        <!-- User의 매수/매도총합 및 잔액 -->
                        <div id="userBuyTotal" style="float:right; color:white; margin:0px 100px; font-size:20px;">User Buy</div>
                        <div id="userSellTotal" style="float:right; color:white; margin:0px 30px; font-size:20px;">User Sell</div>
                        <div id="userBalance" style="float:right; color:white; margin:0px 30px; font-size:20px;">User 잔액</div>


                    </nav>
                </div>
            </div>
        </div>
    </header>

    <script>

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            // localStorage에서 사용자 아이디와 예산을 가져옴
            const userId = localStorage.getItem('oti') || 'Null'; // 기본값 설정
            const userBudget = parseFloat(localStorage.getItem('otb')) || 0; // 기본값 설정

            // 가져온 값으로 헤더에 사용자 정보 표시
            const userIdElement = document.querySelector('.right_username.user-id');
            const userBudgetElement = document.querySelector('.right_username.user-budget');

            // 아이콘과 텍스트를 함께 추가하여 표시
            userIdElement.innerHTML = '<i class="fa-solid fa-circle-user"></i> ' + userId;
            userBudgetElement.innerHTML = '<i class="fa-solid fa-coins"></i> ' + '초기 자산 : ' + userBudget.toLocaleString() + ' 원';
        });


        <!--유저의 매수/매도 총계, 잔액 -->
        function updateHeaderInvestmentInfo() {
    const investmentLogs = JSON.parse(localStorage.getItem('investmentLogs')) || [];
    let totalBuy = 0;
    let totalSell = 0;

    investmentLogs.forEach(log => {
        // 가격 정보에서 "원"을 제외하고 숫자만 추출
        const amount = parseFloat(log.price.split(' ')[0].replace(/,/g, ''));
        if (log.isBuy) { // 불리언 값으로 비교
            totalBuy += amount;
        } else {
            totalSell += amount;
        }
    });

    const initialUserBudget = parseFloat(localStorage.getItem('otb')) || 0;
    const userBalance = initialUserBudget - totalBuy + totalSell;

    document.getElementById('userBuyTotal').textContent = `Buy: ${totalBuy.toLocaleString()} 원`;
    document.getElementById('userSellTotal').textContent = `Sell: ${totalSell.toLocaleString()} 원`;
    document.getElementById('userBalance').textContent = `잔액: ${userBalance.toLocaleString()} 원`;
}

    // 매수 또는 매도 작업 성공 후 호출
    // 예시: 매수나 매도 버튼 클릭 이벤트의 성공 콜백 내
    updateHeaderInvestmentInfo();



    </script>
    <!-- ***** Header Area End ***** -->
</th:block>
</html>
